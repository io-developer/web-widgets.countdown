/**
 * Configurable countdown widget
 * Not requires jQuery or other libs
 * @author Sergey Sedyshev
 * @see find more on github https://github.com/io-developer
 * @build 2015-06-14
 */

var iodev;!function(){function a(){this.main="countdown",this.separator="countdown__separator",this.separatorContent="countdown__separator-content",this.group="countdown__group",this.group_hidden="countdown__group_hidden",this.group_weeks="countdown__group_weeks",this.group_days="countdown__group_days",this.group_hours="countdown__group_hours",this.group_minutes="countdown__group_minutes",this.group_seconds="countdown__group_seconds",this.group_radix_="countdown__group_radix_",this.groupRadix="countdown__group-radix",this.groupLabel="countdown__group-label",this.digit="countdown__digit",this.digit_hidden="countdown__digit_hidden",this.digitUnit="countdown__digit-unit",this.digitUnit_="countdown__digit-unit_",this.digitUnit_hide="countdown__digit-unit_hide",this.digitUnit_hidden="countdown__digit-unit_hidden",this.digitUnitContent="countdown__digit-unit-content",this.digitUnitContent_="countdown__digit-unit-content_"}function b(a){function b(a){var b=m[a];if(b)for(var c=b.length;c-->0;){var d=b[c],e=k.getValueByType(a),f=k.getValueByType(a,d.modifier),g=l.labelForType(a,f);d.setNumber(f,e),d.setLabelContent(g)}}function c(){b(v.WEEKS)}function d(){b(v.DAYS)}function e(){b(v.HOURS)}function f(){b(v.MINUTES)}function h(){b(v.SECONDS)}var i=a,k=new g,l=new j,m={};this.getElement=function(){return i},this.getModel=function(){return k},this.getLabelProvider=function(){return l},this.setLabelProvider=function(a){l=a},this.appendGroupNode=function(a){i!=a.elem.parentNode&&i.appendChild(a.elem);var b=m[a.type];b||(b=m[a.type]=[]),b.push(a)},this.update=function(){k.update(),c(),d(),e(),e(),f(),f()},i.countdownObject=this,k.onWeeksUpdate=c,k.onDaysUpdate=d,k.onHoursUpdate=e,k.onMinutesUpdate=f,k.onSecondsUpdate=h}function c(a){function b(a,b,c){b=b||4,c=c||10,c=0>c?0:c,c=c>36?36:c;for(var d="000000000000000000000000000000"+Number(a).toString(c),e=[],f=-1;++f<b;){var g=f>0?d.slice(-f-1,-f):d.slice(-1);e.push(parseInt(g,c))}return e}var c=this,d=a;this.elem=null,this.radixElem=null,this.labelElem=null,this.digitNodes=[],this.type=v.SECONDS,this.modifier=w.UNRESOLVED,this.radix=10,this.setNumber=function(a,e){for(var f=!0,g=c.digitNodes.length,h=b(a,g,c.radix),i=-1;++i<g;){var j=h[g-i-1],k=this.digitNodes[i];k.showUnit(j),i==g-1&&e>0&&(f=!1),0==j&&f&&k.autohideEnabled?q(k.elem,d.digit_hidden):(f=!1,r(k.elem,d.digit_hidden))}f?q(c.elem,d.group_hidden):r(c.elem,d.group_hidden)},this.setLabelContent=function(a){c.labelElem&&(c.labelElem.innerHTML=a)}}function d(a){var b=this,c=a,d=-1;this.autohideEnabled=!1,this.elem=null,this.unitElems=[],this.showUnit=function(a){var e=b.unitElems[a];if(e&&a!=d){var f=b.unitElems[d];f&&(q(f,c.digitUnit_hide),setTimeout(function(){q(f,c.digitUnit_hidden)},3e3)),r(e,c.digitUnit_hide),r(e,c.digitUnit_hidden),d=a}}}function e(a){var b=this,c=a,d=new f;this.getClassSet=function(){return c},this.setClassSet=function(a){c=a},this.initAll=function(){elems=document.querySelectorAll("."+c.main);for(var a=-1,b=elems.length;++a<b;){var e=elems[a];e.countdownObject||d.build(e,c)}},document.addEventListener("DOMContentLoaded",b.initAll)}function f(){function a(a,c){a.innerHTML="";var d=new b(a),f=parseInt(a.getAttribute(t.TARGET_TIME));f=f||(new Date).getTime()+6048e5+5e3;var g=p(a.getAttribute(t.TARGET_TIME_USE_UTC)),h=a.getAttribute(t.FORMAT)||iodev.widgets.countdown.defaultFormat,i=p(a.getAttribute(t.LABELS_ENABLED)),j=m(a.getAttribute(t.LABELS_LANG)),k=a.getAttribute(t.FORMAT_RADIX);k=k?parseInt(k):10,k=2>k?2:k,k=k>36?36:k;var l=q.parseToDigitGroups(h);return e(d,c,l,i,k),d.getModel().setTargetTime(f),d.getModel().setUseUtc(g),d.setLabelProvider(j),d.update(),d}function e(a,b,c,d,e){for(var h=a.getElement(),i=-1,j=c.length;++i<j;){var k=c[i],l=f(b,k,d,e);a.appendGroupNode(l),h.appendChild(g(b,k.separatorText))}}function f(a,b,d,e){var f=new c(a);f.type=b.type,f.modifier=b.modifier,f.radix=e,f.elem=n('<div class="'+a.group+" "+l(a,b.type)+" "+a.group_radix_+e+'"></div>');for(var g=-1,i=b.digits.length;++g<i;){var j=h(a,b.digits[g],e);f.digitNodes.push(j),f.elem.appendChild(j.elem)}return f.radixElem=o(f.elem,'<div class="'+a.groupRadix+'"></div>'),d&&(f.labelElem=o(f.elem,'<div class="'+a.groupLabel+'"></div>')),f}function g(a,b){return n('<div class="'+a.separator+'"><div class="'+a.separatorContent+'">'+b.replace(/^\s+|\s+$/gi,"")+"</div></div>")}function h(a,b,c){var e=new d(a);e.autohideEnabled=!b.isPermanent,e.elem=n('<div class="'+a.digit+'"></div>');for(var f=-1;++f<c;){var g=o(e.elem,'<div class="'+a.digitUnit+" "+a.digitUnit_+f+" "+a.digitUnit_hide+" "+a.digitUnit_hidden+'"><div class="'+a.digitUnitContent+" "+a.digitUnitContent_+f+'"></div></div>');e.unitElems.push(g)}return e}function l(a,b){var c={};return c[v.WEEKS]=a.group_weeks,c[v.DAYS]=a.group_days,c[v.HOURS]=a.group_hours,c[v.MINUTES]=a.group_minutes,c[v.SECONDS]=a.group_seconds,c[b]||""}function m(a){return a=a?a.toLowerCase():"",a===u.RU?new j:new i}function p(a){return a=(""+a).toLowerCase(),"false"==a||"off"==a||"null"==a||"undefined"==a?!1:a?!0:!1}var q=new k;this.build=function(b,c){var d=null;try{d=a(b,c)}catch(e){console.log("Catched exception in CountdownBuilder.build()"),console.info(e)}return d}}function g(){function a(){clearTimeout(e),e=setTimeout(a,d);var f=h,g=i,j=k,l=n,m=r;b(),h!=f&&c.onWeeksUpdate&&c.onWeeksUpdate(c),i!=g&&c.onDaysUpdate&&c.onDaysUpdate(c),k!=j&&c.onHoursUpdate&&c.onHoursUpdate(c),n!=l&&c.onMinutesUpdate&&c.onMinutesUpdate(c),r!=m&&c.onSecondsUpdate&&c.onSecondsUpdate(c)}function b(){var a=1e3,b=60*a,c=60*b,d=24*c,e=7*d,v=new Date,w=g?v.getTime()-6e4*v.getTimezoneOffset():v.getTime(),y=f-w,z=y>0?y:0;h=Math.floor(z/e),i=Math.floor(z/d),k=Math.floor(z/c),n=Math.floor(z/b),r=Math.floor(z/a),z%=e,j=Math.floor(z/d),m=Math.floor(z/c),q=Math.floor(z/b),x=Math.floor(z/a),z%=d,l=Math.floor(z/c),p=Math.floor(z/b),u=Math.floor(z/a),z%=c,o=Math.floor(z/b),t=Math.floor(z/a),z%=b,s=Math.floor(z/a)}var c=this,d=100,e=0,f=(new Date).getTime(),g=!1,h=-1,i=-1,j=-1,k=-1,l=-1,m=-1,n=-1,o=-1,p=-1,q=-1,r=-1,s=-1,t=-1,u=-1,x=-1;this.onWeeksUpdate=null,this.onDaysUpdate=null,this.onHoursUpdate=null,this.onMinutesUpdate=null,this.onSecondsUpdate=null,this.getUpdateInterval=function(){return d},this.setUpdateInterval=function(a){d=a},this.getTargetTime=function(){return f},this.setTargetTime=function(a){f=a},this.getUseUtc=function(){return g},this.setUseUtc=function(a){g=a},this.getWeeks=function(a){var b={};return b[w.FULL]=h,b[a||w.FULL]},this.getDays=function(a){var b={};return b[w.FULL]=i,b[w.WEEKED]=j,b[a||w.FULL]},this.getHours=function(a){var b={};return b[w.FULL]=k,b[w.WEEKED]=m,b[w.DAYED]=l,b[a||w.FULL]},this.getMinutes=function(a){var b={};return b[w.FULL]=n,b[w.WEEKED]=q,b[w.DAYED]=p,b[w.HOURED]=o,b[a||w.FULL]},this.getSeconds=function(a){var b={};return b[w.FULL]=r,b[w.WEEKED]=x,b[w.DAYED]=u,b[w.HOURED]=t,b[w.MINUTED]=s,b[a||w.FULL]},this.getValueByType=function(a,b){var d={};d[v.WEEKS]=c.getWeeks,d[v.DAYS]=c.getDays,d[v.HOURS]=c.getHours,d[v.MINUTES]=c.getMinutes,d[v.SECONDS]=c.getSeconds;var e=d[a||v.SECONDS];return e?e(b):0},this.update=function(){a()}}function h(){this.labelForType=function(a,b){}}function i(){var a={};a[v.WEEKS]=["Week","Weeks"],a[v.DAYS]=["Day","Days"],a[v.HOURS]=["Hour","Hours"],a[v.MINUTES]=["Minute","Minutes"],a[v.SECONDS]=["Second","Seconds"],this.getTextDictionary=function(){return a},this.setTextDictionary=function(b){a=b},this.labelForType=function(b,c){var d=a[b],e=c%10;return 1==e?d[0]:d[1]}}function j(){var a={};a[v.WEEKS]=["Неделя","Недели","Недель"],a[v.DAYS]=["День","Дня","Дней"],a[v.HOURS]=["Час","Часа","Часов"],a[v.MINUTES]=["Минута","Минуты","Минут"],a[v.SECONDS]=["Секунда","Секунды","Секунд"],this.getTextDictionary=function(){return a},this.setTextDictionary=function(b){a=b},this.labelForType=function(b,c){var d=a[b],e=c%100;return e>4&&20>e?d[2]:(e=c%10,1==e?d[0]:e>0&&5>e?d[1]:d[2])}}function k(){function a(a){for(var b=[],e=null,f=null,g=-1,h=a.length;++g<h;){var i=f;if(f=a.charAt(g),f!==x.ESCAPER)if(i!==x.ESCAPER){if(f!==x.MODIFIER)if(i!==x.MODIFIER){var j=d[f.toLowerCase()];if(j){(null===i||i.toLowerCase()!==f.toLowerCase())&&(e=new m,e.type=j,b.push(e));var k=new l;k.isPermanent=f===f.toUpperCase(),k["char"]=f,e.digits.push(k)}else e&&(e.separatorText+=f)}else e&&c(f,e)}else e&&(e.separatorText+=f)}return b}function b(a){for(var b=null,c=-1,d=a.length;++c<d;){var f=b;b=a[c],b.modifier===w.UNRESOLVED&&(b.modifier=w.FULL,f&&(b.modifier=e[f.type]||b.modifier))}}function c(a,b){if(b.modifier=f[a],!b.modifier)throw new Error("Unexpected option char '"+a+"' in countdown format")}var d={};d[x.DIGIT_WEEKS]=v.WEEKS,d[x.DIGIT_DAYS]=v.DAYS,d[x.DIGIT_HOURS]=v.HOURS,d[x.DIGIT_MINUTES]=v.MINUTES,d[x.DIGIT_SECONDS]=v.SECONDS;var e={};e[v.WEEKS]=w.WEEKED,e[v.DAYS]=w.DAYED,e[v.HOURS]=w.HOURED,e[v.MINUTES]=w.MINUTED;var f={};f[y.VALUE_AUTO]=w.UNRESOLVED,f[y.VALUE_FULL]=w.FULL,f[y.VALUE_WEEKED]=w.WEEKED,f[y.VALUE_DAYED]=w.DAYED,f[y.VALUE_HOURED]=w.HOURED,f[y.VALUE_MINUTED]=w.MINUTED,this.parseToDigitGroups=function(c){var d=a(c);return b(d),d}}function l(){this.isPermanent=!0,this["char"]=""}function m(){this.type=v.SECONDS,this.modifier=w.UNRESOLVED,this.separatorText="",this.digits=[]}function n(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}function o(a,b){return a.appendChild(n(b))}function p(a,b){return s(a,b)>=0}function q(a,b){p(a,b)||(a.className+=" "+b)}function r(a,b){var c=s(a,b);if(c>=0){var d=a.className;a.className=d.slice(0,c)+d.slice(c+b.length)}}function s(a,b){for(var c=a.className.replace(/\s/gi," "),d=-1,e=b.length;;){if(d=c.indexOf(b,d),d>=0){if(d>0&&" "!=c.charAt(d-1))continue;if(d+e<c.length-1&&" "!=c.charAt(d+e))continue}break}return d}if(!(iodev&&iodev.widgets&&iodev.widgets.countdown)){var t={FORMAT:"data-format",FORMAT_RADIX:"data-format-radix",TARGET_TIME:"data-target-time",TARGET_TIME_USE_UTC:"data-target-time-use-utc",LABELS_ENABLED:"data-labels-enabled",LABELS_LANG:"data-labels-lang"},u={EN:"en",RU:"ru"},v={WEEKS:"weeks",DAYS:"days",HOURS:"hours",MINUTES:"minutes",SECONDS:"seconds"},w={UNRESOLVED:"unresolved",FULL:"full",WEEKED:"weeked",DAYED:"dayed",HOURED:"houred",MINUTED:"minuted"},x={ESCAPER:"\\",MODIFIER:"/",DIGIT_WEEKS:"w",DIGIT_DAYS:"d",DIGIT_HOURS:"h",DIGIT_MINUTES:"m",DIGIT_SECONDS:"s"},y={VALUE_AUTO:"a",VALUE_FULL:"f",VALUE_WEEKED:"w",VALUE_DAYED:"d",VALUE_HOURED:"h",VALUE_MINUTED:"m"};iodev=iodev||{},iodev.widgets=iodev.widgets||{},iodev.widgets.countdown={CountdownClassSet:a,CountdownAttributes:t,CountdownLangs:u,Countdown:b,CountdownGroupNode:c,CountdownDigitNode:d,CountdownDom:e,CountdownBuilder:f,CountdownModel:g,CountdownLabelProvider:h,CountdownLabelProviderRU:j,CountdownTypes:v,CountdownModifiers:w,CountdownFormatParser:k,CountdownFormatDigit:l,CountdownFormatGroup:m,CountdownFormatChars:x,CountdownFormatModifiers:y,defaultDom:new e(new a),defaultFormat:"WW D HH:MM:SS"}}}();var deepselect=function(a){return deepselect.create(a)};deepselect.events={select:"deepselectSelect",selectStart:"deepselectStart",selectComplete:"deepselectSelectComplete"},deepselect.cssClasses={main:"deepselect",node:"deepselect-node",nodeContainer:"deepselect-node-container",nodeOption:"deepselect-node-option"},deepselect.create=function(a){var b=a.dataProvider||new deepselect.DataProvider(a.data),c=[],d=a.cssClasses||[];for(var e in deepselect.cssClasses)c[e]=d[e]||deepselect.cssClasses[e];var f=document.createElement("div");f.className=c.main;var g=new deepselect.Renderer(f,c,a.enableLabels,a.label,a.labelSelectable,a.labelValue),h=new deepselect.Controller(b,f,g);return f.isCompleted=h.isCompleted,f.currentIndexes=h.currentIndexes,f.currentValues=h.currentValues,f.controller=function(){return h},f.onSelect=function(a){f.addEventListener(deepselect.events.select,a.bind(f))},f.onSelectStart=function(a){f.addEventListener(deepselect.events.selectStart,a.bind(f))},f.onSelectComplete=function(a){f.addEventListener(deepselect.events.selectComplete,a.bind(f))},f},deepselect.Controller=function(a,b,c){function d(){o=[],p=[];for(var b=c.getValues(),d=-1,e=n.length;++d<e;){var f=a.getItemAt(n.slice(0,d+1));o.push(f),p.push(f?f.value:b[d])}}function e(b){var d=a.getItemAt(b),e=c.addNode(d);return e&&f(e,b),e}function f(a,b){var d=c.isEnableLabels()?1:0;a.addEventListener("change",function(c){var e=a.selectedIndex-d;k.handleSelectAt(b.concat(e))})}function g(a){var b;return document.createEvent?(b=document.createEvent("Event"),b.initEvent(a,!0,!1)):b=new Event(a),b}function h(a){var c=g(a);c.selectedIndexes=n.concat(),c.selectedItems=o.concat(),c.selectedValues=p.concat(),b.dispatchEvent(c)}function i(){d(),h(deepselect.events.select),m&&(m=!0,h(deepselect.events.selectStart))}function j(){m=!1,d(),h(deepselect.events.selectComplete)}var k=this,l=(window.navigator.userAgent.indexOf("MSIE ")>-1,!1),m=!1,n=[],o=[],p=[],q=0;k.isCompleted=function(){return l},k.getRenderer=function(){return c},k.getDataProvider=function(){return a},k.currentIndexes=function(a){return a&&k.selectByIndexes(a),d(),n.concat()},k.currentValues=function(a){return a&&k.selectByValues(a),d(),p.concat()},k.selectByIndexes=function(a){k.handleSelectAt(a.slice(0,a.length-1)),k.handleSelectAt(a.slice(0,a.length)),c.setSelectedIndexes(a)},k.selectByValues=function(b){k.selectByIndexes(a.getIndexesByVals(b))},k.handleSelectAt=function(b){b=b||[];var d=b[b.length-1],f=a.getItemsAt(b);if(f||!(d>=0)){for(var g=-1,h=Math.min(b.length,n.length);++g<h&&b[g]==n[g];);var k=--g;for(h=n.length;++k<h;)n.pop(),c.popNode();var m=null;for(h=b.length;++g<h;){var o=b[g];n.push(o),m=e(n.concat())}0==h&&(n=[],c.popNode(),m=e(n.concat())),++q,m&&arguments.callee(b.concat(c.isEnableLabels()?-1:0)),--q,0==q&&(l=!m,i(),l&&j())}},k.handleSelectAt()},deepselect.Renderer=function(a,b,c,d,e,f){var g=this,h=[],i=[];b=b||deepselect.cssClasses,d=d||"Choose...",f=f||"",g.isEnableLabels=function(){return c},g.getValues=function(){for(var a=[],b=-1,c=h.length;++b<c;){var d=h[b];d&&a.push(d.value)}return a},g.setSelectedIndexes=function(a){for(var b=c?1:0,d=-1,e=Math.min(a.length,h.length);++d<e;){var f=h[d];f.selectedIndex=a[d]+b}},g.popNode=function(){i.length>0&&(h.pop(),child=i.pop(),child&&a.removeChild(child))},g.addNode=function(j){var k=null,l=(j?j.items:null)||[],m=l.length;if(m>0){if(k=document.createElement("select"),k.className=b.node,c){var n={};n.name=j.label||d,n.value=void 0!==j.labelValue?j.labelValue:f,n.selected=!0,n.disabled=!(void 0!==j.labelSelectable?j.labelSelectable:e),k.appendChild(g.renderNodeItem(n))}for(var o=-1;++o<m;)k.appendChild(g.renderNodeItem(l[o]));var p=g.renderNodeContainer(k);a.appendChild(p)}return h.push(k),i.push(p),k},g.renderNodeContainer=function(a){return el=document.createElement("div"),el.className=b.nodeContainer,el.appendChild(a),el},g.renderNodeItem=function(a){var c=document.createTextNode(a.name),d=document.createElement("option");return d.className=b.nodeOption,d.appendChild(c),d.setAttribute("value",void 0!==a.value?a.value:""),a.disabled&&d.setAttribute("disabled","disabled"),a.selected&&d.setAttribute("selected","selected"),d}},deepselect.DataProvider=function(a){function b(b){for(var c=a,d=c.items,e=-1,f=b.length;++e<f;){var g=b[e];if(!(g>=0&&g<d.length)){c=null,d=null;break}c=d[g],d=c.items||[]}return{item:c,items:d}}var c=this;c.getItemAt=function(a){return b(a).item},c.getItemsAt=function(a){return b(a).items},c.getIndexesByVals=function(b){for(var c=b.concat(),d=[],e=a.items;c.length;){for(var f=c.shift(),g=e.length;g-->0&&e[g].value!=f;);if(d.push(g),!(g>-1&&(e=e[g].items)))break}return d}};